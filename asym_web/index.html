<html><meta http-equiv="Content-type: text/html; charset=UTF-8">
<head><title>Asymmetry Server Demo</title>
<script src="/libs/js/jquery.min.js"></script>
<script src="/libs/zimap/zimm.js"></script>
</head>
<body>
<style type="text/css">

#tooltip {
  z-index: 9999;
  position: absolute;
  display: none;
  top:0px;
  left:0px;
  background-color: #000;
  padding: 5px 10px 5px 10px;
  color: white;
  .opacity(0.5);
  .rounded(5px); 
}}

</style>
<div id="tooltip"></div>
<p id="test">Демо-версия программы (<a href="desktopver.html">о полной версии</a>)</p>
<select size="1" name="par" id="par" onchange="parSel()">
</select>
<select size="1" name="year" id="year" onchange="yearSel()"></select>
<!-- button onclick="repaintMap()">Визуализировать</button -->
Раскрашивание:
<input type="radio" name="coltype" value="Block" checked onchange="ctSel(this)">Блоками
<input type="radio" name="coltype" value="Gradient" onchange="ctSel(this)">Непрерывное
<div width='1000' height='500' id='mapdiv'>
<object data="/libs/zimap/maps/russia.svg" type="image/svg+xml" id="mymap" width="1000" height="500" viewBox="0 0 1300 610" onload=tt()>
</object>
</div>
<textarea rows="10" cols="45" id="dat" style='display:none;'>qq</textarea>

<script type="text/javascript">
var csvData;
var head;
var grad = false;

function drawPars(data){
  var pars = document.getElementById('par');
  pars.innerHTML = '';
  var mas = data.split('\n');
  var sel;
  for(var i in mas){
	var str = mas[i].split(';');
	var opt = document.createElement('option');
	opt.value = str[1];
	opt.innerHTML = str[0];
	if(i == 0){
	  opt.selected = 'selected';
	}
	pars.appendChild(opt);
  }
  parSel();
}

function parSel(){
  $("#mapdiv").css({ "opacity" : "0.5" });
  hide_tooltip();
  var par = document.getElementById('par');
  var datadr = '/libs/data/'+par.value;
  $.ajax({
    url: datadr,
    dataType:'html',
    success: function(data){csvData = data;drawYears(data);}
  });
}

function drawYears(data){
  var years = document.getElementById('year');
  var tmp;
  if(years.innerHTML !=''){
	tmp = years.childNodes[years.value - 1].innerHTML;
//alert(tmp);
  }
  years.innerHTML = '';
  head = data.split('\n')[0].split(';');
  var last;
  var sel = '';
  for(var i = 1; i<head.length; i++){
	var opt = document.createElement('option');
	opt.value = i;
	opt.innerHTML = head[i];
	years.appendChild(opt);
	last = opt;
	if(head[i] == tmp)
		sel = opt;
  }
  if(sel != '')
	last = sel;
  last.selected = 'selected';
  yearSel();
}

function yearSel(){
  hide_tooltip();
  var year = document.getElementById('year');
  procData(csvData,year.value);
}

function procData(data,j){
  $("#mapdiv").css({ "opacity" : "0.5" });
  dat.value = data;
  var svg = document.getElementById('mymap');
  var svgd = svg.contentDocument;
  var colors = ['#330099','#0000ff','#6666ff','#ccccff'];
  zimap_draw_x(data,svgd,colors,j,';',1,grad);
  $("#mapdiv").css({ "opacity" : "1" });
}


function tt(){
  $("#mapdiv").css({ "opacity" : "0.5" });
  var svg = document.getElementById('mymap');
  var svgd = svg.contentDocument;
  tutle(svgd);
  var info = '/libs/data/info.txt';
  $.ajax({
    url: info,
    dataType: 'html',
    success: function(data){drawPars(data);}
  });

  

  $(svgd.getElementsByClassName('region')).mousedown(function (eventObject) {
	$title = $(this).children(1).text();
	show_tooltip($title,eventObject);
  }).hover(function (eventObject) {
	$title = $(this).children(1).text();
	show_tooltip($title,eventObject);
  }).mouseout(function () {
	if ( $.browser.msie ) {}else{
		hide_tooltip();
	}
  });
}

function tutle(svgd){
  var ts = svgd.getElementsByTagName('title');
  for(var i=ts.length-1;i>=0;i--){
    var tl = ts[i];
    var tu = svgd.createElement('tutle');
    tu.textContent = tl.textContent;
    var reg = tl.parentNode;
    //if(reg == null || reg == undefined)
      //alert(""+tl.textContent+"@"+reg);
    reg.insertBefore(tu,tl);
    reg.removeChild(tl);
  }

}


function show_tooltip($title,eventObject){
  $("#tooltip").text($title).css({ 
	"top" : eventObject.pageY + 35,
	"left" : eventObject.pageX + 5
  }).show();
}

function hide_tooltip(eventObject){
  $("#tooltip").hide().text("").css({"top" : 0,"left" : 0});
}

function ctSel(ra){
  grad = (ra.value == 'Gradient');
  yearSel();
}
</script>
<br/><hr/>
<footer>
Автор - <a href="mailto:zaycev.ivan@gmail.com">Зайцев И.Д.</a> (zaycev.ivan@gmail.com)<br/><br/>
Источник данных - <a href="http://www.gks.ru">Сайт Федеральной службы государственной статистики РФ</a><br/>
Источник карты - <a href="http://commons.wikimedia.org/wiki/File%3AMap_of_Russian_districts%2C_2008-03-01.svg"/>Википедия</a><br/>
</footer>
<script>
if(location.href.split('/')[2]!='127.0.0.1'){
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41768406-1', 'navizv.github.io');
  ga('send', 'pageview');
}
</script>
</body>
</html>